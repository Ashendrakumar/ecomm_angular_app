<div class="container cart-page">
  <header class="cart-page__header">
    <h1 class="cart-page__title">Shopping Cart</h1>
    <!-- @if (cartService.isAuthenticated()) {
      <span class="cart-page__badge">Saved to your account</span>
    } @else {
      <span class="cart-page__badge cart-page__badge--guest">Guest cart · saved in browser</span>
    } -->
  </header>

  @if (cartService.lastError()) {
  <div class="alert alert-warning cart-page__alert" role="alert">
    {{ cartService.lastError() }}
    <button type="button" class="btn-close btn-close-white ms-2" aria-label="Dismiss" (click)="dismissError()"></button>
  </div>
  }
  @if (cartService.isLoading() && cartItems().length === 0) {
  <div class="cart-page__loading">
    <div class="spinner-border text-gold" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>
  }
  @if (!cartService.isLoading() && cartItems().length === 0) {
  <app-no-data-found title="Your cart is empty" actionName="Browse Products"
    message="Add some products to get started!" />
  }
  @if (cartItems().length > 0) {
  <div class="row g-4">
    <div class="col-lg-8">
      <div class="card bg-dark-custom cart-page__list">
        <div class="card-body">
          @for (item of cartItems(); track item.id) {
          @if (isUpdating(item.id) || isRemoving(item.id)) {
          <app-skeleton-loader type="cart-item" [skeletonCount]="1" />
          } @else {
          <article class="cart-page__item">
            <div class="cart-page__item-image">
              <img [src]="item.product.images[0] || 'https://placehold.co/200x200?text=Product'"
                [alt]="item.product.name" class="img-fluid rounded" />
            </div>
            <div class="cart-page__item-details">
              <h5 class="cart-page__item-title">
                <a [routerLink]="['/products', item.product.id]">
                  {{ item.product.name }}
                </a>
              </h5>
              <p class="text-muted small mb-1">{{ item.product.brand }}</p>
              @if (item.selectedVariants.length > 0) {
              <div class="cart-page__item-variants">
                @for (variant of item.selectedVariants; track variant.variantId) {
                <span class="badge bg-secondary me-1">
                  {{ variant.variantName }}: {{ variant.optionValue }}
                </span>
                }
              </div>
              }
            </div>
            <div class="cart-page__item-qty">
              <div class="input-group input-group-sm cart-page__qty-controls">
                <button class="btn btn-outline-primary" type="button"
                  (click)="updateQuantity(item.id, item.quantity - 1)"
                  [disabled]="isUpdating(item.id) || item.quantity <= 1" aria-label="Decrease quantity">
                  −
                </button>
                <input type="number" class="form-control text-center" [value]="item.quantity"
                  (input)="onQuantityInput(item.id, $event)" min="1" step="1" [max]="99" aria-label="Quantity" />
                <button class="btn btn-outline-primary" type="button"
                  (click)="updateQuantity(item.id, item.quantity + 1)" [disabled]="isUpdating(item.id)"
                  aria-label="Increase quantity">
                  +
                </button>
              </div>
            </div>
            <div class="cart-page__item-price">
              <span class="text-gold fw-bold">${{ getItemTotalFormatted(item) }}</span>
              <small class="text-muted d-block">${{ getItemPriceFormatted(item) }} each</small>
            </div>
            <div class="cart-page__item-actions">
              <button class="btn btn-sm btn-outline-danger" (click)="removeItem(item.id)"
                [disabled]="isRemoving(item.id)">
                Remove
              </button>
            </div>
          </article>
          }
          }
        </div>
      </div>
    </div>

    <div class="col-lg-4">
      <div class="card bg-dark-custom cart-page__summary">
        <div class="card-header">
          <h5 class="mb-0">Order Summary</h5>
        </div>
        <div class="card-body">
          <div class="cart-page__summary-row">
            <span>Items ({{ cartService.cartItemCount() }})</span>
            <span>${{ getCartTotalFormatted() }}</span>
          </div>
          <div class="cart-page__summary-row">
            <span>Shipping</span>
            <span class="text-success">Free</span>
          </div>
          <hr class="cart-page__summary-hr" />
          <div class="cart-page__summary-row cart-page__summary-total">
            <strong>Total</strong>
            <strong class="text-gold">${{ getCartTotalFormatted() }}</strong>
          </div>
          <button class="btn btn-primary w-100 mb-2" (click)="checkout()">
            Proceed to Checkout
          </button>
          <a routerLink="/products" class="btn btn-outline-secondary w-100">
            Continue Shopping
          </a>
        </div>
      </div>
    </div>
  </div>
  }
</div>